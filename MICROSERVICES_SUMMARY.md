# Microservices Architecture - Implementation Summary ## Completed Services ### 1. User Management Service **Location**: `src/usermanagement_service/` - **Status**: Fully functional - **Features**: - User registration endpoint - Database persistence (PostgreSQL) - Kafka producer for user registration events - gRPC server for user validation - **Port**: 5001 (external), 9091 (internal) - **Database**: `REGISTRATIONS` (port 3304) ### 2. Task Processing Service **Location**: `services/taskprocessing/` - **Status**: Created and ready - **Features**: - Task management endpoints - Kafka producer for task events - Database persistence - **Port**: 5002 (external), 9092 (internal) - **Database**: `TASK_PROCESSING` (port 3306) ### 3. Notification Service **Location**: `src/notification_service/` - **Status**: Created and ready - **Features**: - Kafka consumer for multiple topics - Notification logging to database - Event processing for: - User registration notifications - Task processing events - Various service events - **Port**: 5003 (external), 9093 (internal) - **Database**: `NOTIFICATIONS` (port 3307) - **Kafka Topics Consumed**: - `user-registration-events` - `booking-events` - `flight-updates` ### 4. Token Management Service (Auth) **Location**: `src/tokenmanagement_service/` - **Status**: Existing service - **Note**: Needs docker-compose integration ## Infrastructure ### Kafka Setup - **Zookeeper**: Port 2181 - **Kafka Broker**: Port 29092 (internal), 9092 (external) - **Topics**: - `user-registration-events` - User Management → Notification - Task processing events - Various service event topics ### Database Setup - Separate PostgreSQL instances for each service - Health checks configured - Persistent volumes for data ## Event Flow ### User Registration Flow 1. Client → User Management Service (POST /registerUser) 2. User Management Service → Database (save user) 3. User Management Service → Kafka (`user-registration-events` topic) 4. Notification Service ← Kafka (consumes event) 5. Notification Service → Database (log notification) 6. Notification Service → Send email/SMS (future implementation) ### Task Processing Flow 1. Client → Task Processing Service (POST task endpoint) 2. Task Processing Service → Database (save task) 3. Task Processing Service → Kafka (publish task event) 4. Notification Service ← Kafka (consumes event) 5. Notification Service → Process notification ## File Structure ``` services/ usermanagement/ # User Management Microservice taskprocessing/ # Task Processing Microservice notification/ # Notification Microservice logmonitor/ # Log Monitoring Service common/ # Shared utilities (pyportal_common) app_handlers/ # Flask app management db_handlers/ # Database connection pooling error_handlers/ # Error response handlers grpc_service_handlers/ # gRPC client/server kafka_service_handlers/ # Kafka producer/consumer logging_handlers/ # Logging utilities ``` ## Docker Compose Services All services are configured in `docker-compose.yml`: - `registration-db` - User Management DB - `auth-db` - Token Management DB - `taskprocessing-db` - Task Processing DB - `notification-db` - Notification logs DB - `zookeeper` - Kafka dependency - `kafka` - Message broker - `usermanagement-service` - User Management API - `taskprocessing-service` - Task Processing API - `notification-service` - Notification processor - `logmonitor-service` - Log monitoring dashboard ## Performance Configuration

All services are configured with:
- **Gunicorn**: 4 workers × 2 threads per service
- **Database Connection Pooling**: 10 base connections + 5 overflow per worker
- **Target Capacity**: 1000-2000 requests/second per service instance

See [PERFORMANCE_CONFIG.md](PERFORMANCE_CONFIG.md) for detailed configuration.

## Next Steps 1. **Test Services**: Bring up all containers and test endpoints 2. **Load Testing**: Use `scripts/load_test_all_services.py` to verify performance 3. **Complete Auth Service**: Integrate token service into docker-compose 4. **Add API Gateway**: For unified entry point 5. **Add Service Discovery**: For dynamic service location 6. **Implement Email/SMS**: Actual notification sending 7. **Add Monitoring**: Health checks, metrics, logging ## Quick Start ```bash # Start all services docker-compose up -d --build # Check status docker-compose ps # View logs docker-compose logs -f # Stop all services docker-compose down ``` 